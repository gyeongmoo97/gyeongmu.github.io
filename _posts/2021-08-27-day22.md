---
title: Day22 Controller
layout: single
author_profile: true
read_time: true
comments: true
share: true
related: true
categories:
- DB
description: .

meta_keywords: java,static,memory
last_modified_at: '2021-08-10 12:00:00 +0800'
toc: true
toc_sticky: false
toc_label: 목차
---



# 이전시간

mapping을 해봄

html 파일로 웹을 보여주기 위해서 jsp 파일로 mapping 하는 과정임



@Controller



@RequestMapping("/ch02")



<%@ include file="/WEB-INF/views/common/header.jsp" %>

include 

```html
<span class="mr-2">Ch02.</span><a class="text-white" href="ch02/content">Controller/RequestMapping</a>
```

href앞에는 8080 앞의 내용생략됨



![image](https://user-images.githubusercontent.com/65274952/131052829-be495232-099e-42e5-a33f-612d5268a86b.png)



# **Controller**



## RequestMapping

클래스에 @RequestMapping적용되면 공통 경로

메소드에 @RequestMapping, @GetMapping, @PostMapping 적용되면 세부 경로



## 요청방식에 따른 Mapping

redirect??

```java
@RequestMapping("/content")
	public String content() {
		logger.info("ch02실행");
		return "ch02/content";
		//return 값은 defualt경로 + return 값.jsp 파일을 연다.
	}
```

요청과 메서드를 연결해주는 requestMapping 임



```java
@GetMapping("/method1")
	public String method1() {
		return "redirect:/ch02/content";
	}
	
	@PostMapping("/method2")
	public String method2() {
		return "redirect:/ch02/content";
	}
	
	@PutMapping("/method2")
	public String method3() {
		return "redirect:/ch02/content";
	}
	
	@DeleteMapping("/method4")
	public String method4() {
		return "redirect:/ch02/content";
	}
```

get post put delete 등 특정 방식의 요청이 ㅇ들어왔을 때만 

요청화 메서드를 연결 시켜주는 것도 가능하다.



같은 주소여도 요청방식에 따라 다른 메서드를 실행 시킬 수 있다.

만약 요청방식과 관계없이 경로만 맞다면 RequestMapping 사용



# JS script삽입법

```java
<%@ page contentType= "text/html; charset=UTF-8" %>

<%@ include file="/WEB-INF/views/common/header.jsp" %>

<div class="card m-2">
	<div class="card-header">
		Controller/RequestMapping
	</div>
	<div class="card-body">
		<div class="card m-2">
			<div class="card-header">
				요청방식 별 메소드 매핑
			</div>
			<div class="card-body">
				<button class="btn btn-info btn-sm">GET방식</button>
				<button class="btn btn-info btn-sm">POST방식</button>
				<button class="btn btn-info btn-sm">PUT방식</button>
				<button class="btn btn-info btn-sm">DELETE방식</button>
				
			</div>
		</div>
		
		
	</div>
</div>

<%@ include file="/WEB-INF/views/common/footer.jsp" %>
```





## **redirect** 

다시 호출해주는거임

```java
		return "redirect:/ch02/content";
```



![image](https://user-images.githubusercontent.com/65274952/131062660-bf8c8bdd-449c-4e02-9a74-65e01ccbf117.png)
form 으로 요청할 수 있는거 get post 둘 밖에 없다. put delete 안됨.
![image](https://user-images.githubusercontent.com/65274952/131062701-53c751fa-e2d0-414d-963b-7b9e30574266.png)
요청 매핑 메서드 작성

![image](https://user-images.githubusercontent.com/65274952/131063916-2e7547c1-ed5d-4d54-9f76-bde8bf841636.png)
이 컨트롤러 메서드의 요청경로는 
아래와 같다.
![image](https://user-images.githubusercontent.com/65274952/131063903-894a602c-2112-4d1a-9df1-960bd88844cf.png)







![image](https://user-images.githubusercontent.com/65274952/131064289-78725c0a-7e77-4470-8a1d-1ff6b10c823d.png)

1. 요청이 들어옴
2. 요청에 맞는 메서드가 실행됨
3. 결과로 jsp를 줌
4. 브라우저에 뜸

![image](https://user-images.githubusercontent.com/65274952/131064417-7428c1d6-d9d2-4499-b163-1b5615212658.png)

return 값이 redirect 면?

브라우저에게 감

브라우저에게 reidrect 값으로 요청하라고 시켜줌

![image](https://user-images.githubusercontent.com/65274952/131064499-3ae3fd60-c671-46bb-b284-a4d3569a65ba.png)

브라우저에 리다이렉트 리턴해주면

브라우저는 리다이렉트의 주소로 재요청을 해야함



![image](https://user-images.githubusercontent.com/65274952/131064604-4f2d04bf-cc93-4bc2-922f-9b50cb3fd35f.png)

최종적으로는 화면에 리다이렉트요청에의해 브라우저가 다시 요청한 화면이 나온다.





결과 url 이 바뀐다 (브라우저가 redirect 한 값으로 url이 바뀌니까)





리다이렉트를 하면 로그인 -> 로그인 화면 -> 메인화면 으로 바르게 이동함

![image](https://user-images.githubusercontent.com/65274952/131064823-7ed753a9-9a66-4acc-ad9c-70dfe737cd59.png)







사용예시 : 로그인 성공시 홈화면으로 이동 

게시물 작성하고 게시물 작성되었습니다 -> 게시물목록 으로 가는게 아닌

게시물 -> 게시물 목록 (redirect)





예제

```
<a class = "btn btn-info btn-sm" href="/ch02/boardlist">게시물 목록</a>
				<a class = "btn btn-info btn-sm" href="/ch02/boardwriteform">게시물 작성</a>
				
				
```

링크로 요청왔음 -> get 방식

![image](https://user-images.githubusercontent.com/65274952/131066920-d92c721e-cdf4-4e86-9be5-91f76a7b0aa7.png)

![image](https://user-images.githubusercontent.com/65274952/131067126-79d87556-2f54-4abf-8b40-4314f123b8aa.png)
url과 페이지가 다름


![image](https://user-images.githubusercontent.com/65274952/131067170-65279ebe-9b71-4b36-b1e1-e71a750209a1.png)

새로고침할때마다 목록이 갱신되는게 아니라 게시물이 여러개 작성됨

redirect 쓰면 목록과 url 이 일치됨
![image](https://user-images.githubusercontent.com/65274952/131067378-59e99ac6-6a18-4c42-9332-c3dfeaded035.png)



## java 어노테이션 작성법 

```java
@RequestMapping(value="/method")
//는 어노테이션에 단일한 값이 들어가 있어서
@RequestMapping("/method") 
//속성을 생략하고 표시가능

//하지만 2개 이상의 속성을 표시해야하는 상황이면 anotation 안의 속성(value, method)를 명시해줘야한다.
@RequestMapping(value="/method", method = RequestMethod.GET)
```



```java
@GetMapping("/method")
	@RequestMapping(value="/method", method = RequestMethod.GET)
```





# PostMan

http 요청을 원하는대로 줄 수 있음

서버의 동작을 test 하는 툴로 사용

사용하는 것을 아는것이 좋다고함



프론트가 미완성일때 백엔드를 테스트 하려면 postman 사용하면 좋다.

https://www.postman.com/

![image](https://user-images.githubusercontent.com/65274952/131057319-fc4e1d19-1993-442f-9053-ecca5e04f7e3.png)



![image](https://user-images.githubusercontent.com/65274952/131057822-32b62b87-a8c7-4530-812f-fe4e95cee199.png)



![image](https://user-images.githubusercontent.com/65274952/131057850-d5f71cdb-7e29-4a8c-ad36-b6f0b531f098.png)

![image](https://user-images.githubusercontent.com/65274952/131057884-d805cee6-c584-454a-88d4-6df42e5fe36d.png)

여러가지 요청방식 정할 수 있따.

![image](https://user-images.githubusercontent.com/65274952/131057934-e13ee41d-9a56-499b-b010-23ee3032d5e6.png)





![image](https://user-images.githubusercontent.com/65274952/131058203-79f30079-4e2e-4892-b5a0-21068ac24e6d.png)

![image](https://user-images.githubusercontent.com/65274952/131058336-e1370616-7063-4ae1-9d62-77b93ddbf67e.png)

잘 작동함





# 요청방식별 매핑

요청이 어떠한 방식으로 기술되어서 서버로 들어오나?

![image](https://user-images.githubusercontent.com/65274952/131058430-08be5f86-aeb5-4f1e-8b92-9ac5a9a2b957.png)

시작행에 요청방식이 포함됨.

크롬과 이클립스에서 확인해보기 =>



크롬 network 에서 확인가능

![image](https://user-images.githubusercontent.com/65274952/131058660-6ddcad24-e045-40f3-8b24-be4617dc1532.png)







![image](https://user-images.githubusercontent.com/65274952/131058690-cd1b9013-9571-49d2-815b-57f219687960.png)
![image](https://user-images.githubusercontent.com/65274952/131058712-7f35bd66-0c74-41d0-aae8-4c355cbd658e.png)
![image](https://user-images.githubusercontent.com/65274952/131058728-416de62a-9e49-4027-af5f-c27d8421848a.png)

![image](https://user-images.githubusercontent.com/65274952/131058757-683cc7ee-722f-42e4-8c60-8ed2ed8cff90.png)
![image](https://user-images.githubusercontent.com/65274952/131058778-e5d07f8e-a960-45b3-a19c-255d09d97ec8.png)

![image](https://user-images.githubusercontent.com/65274952/131058787-6769f0f7-cdcb-419c-a3c1-5d3a9e50cb61.png)

![image](https://user-images.githubusercontent.com/65274952/131058814-0c2d8fda-4f49-4e80-987b-3abb97729536.png)



![image](https://user-images.githubusercontent.com/65274952/131058991-bca44a8d-cb7e-496b-acff-6f6eccf47573.png)


![image](https://user-images.githubusercontent.com/65274952/131058945-45c1b5bd-48da-4447-ae69-5e2541062fc9.png)

중간에 TCP모니터라는 만들고 8090포트를 할당해준다.
TCP 모니터는 브라우저와 서버의 중간다리 역할을 하면서 중간에 왔다갔다하는 데이터를 볼 수 있게 해준다.



![image](https://user-images.githubusercontent.com/65274952/131059348-e153906a-5ba8-4c42-8cf7-6d2cf4e1e915.png)

왼쪽은 브라우저가 서버로 보낸 http (Request Http)
오른쪽은 서버가 브라우저에게 보낸 http (Response Http)
브라우저와 서버는 http 로 통신을 하고 tcp 모니터로 그것을 보여줌
![image](https://user-images.githubusercontent.com/65274952/131059565-69b96b21-0e93-44d2-8176-392ca9474520.png)

지금은 브라우저의 요청에 대해 중심적으로 본다.
특히 **요청방식**이 어디에 기술되어서 넘어가는지를 본다.



**요청방식은 http의 가장 첫부분** **header**에 실려서 넘어온다.

![image](https://user-images.githubusercontent.com/65274952/131059840-92e1e1b7-cf13-40a3-a849-03638a25d8e6.png)

추후에 어떤 상황에 어떤 요청방식쓰는지 배운다



# 요청방식 정리

![image](https://user-images.githubusercontent.com/65274952/131061358-20d49148-ed3e-49d0-b95b-7f20d938571d.png)

![image](https://user-images.githubusercontent.com/65274952/131061365-8c234d31-1f4c-468f-9713-ab443dc94881.png)

32page 까지의 실습 진행했다.









# 요청 매핑 메소드의 매개변수 및 리턴 타입

content 의 괄호안에 뭐가 들어갈 수 있냐?

return 시킬 수 있는 값이 뭐가 있냐?



```java
@RequestMapping("/content")
	public String content() {
		logger.info("ch02실행");
		return "ch02/content";
		//return 값은 defualt경로 + return 값.jsp 파일을 연다.
	}
```

| 매개변수 타입                                        | 설명                                               |
| ---------------------------------------------------- | -------------------------------------------------- |
| 요청 파라미터 매개변수                               | 요청 파라미터 이름과 동일한 매개변수               |
| HttpServletRequest, HttpServletResponse, HttpSession | 서블릿 API(서블릿 low API를 직접 이용하고자 할 때) |
| InputStream, Reader, OutputStream, Writer            | HTTP의  바디 내용을 직접 읽고 출력하고자 할 때     |
| @RequestParam 적용 매개변수                          | HTTP  요청 파라미터와 매개변수를 매핑할 때(Ch03)   |
| @RequestHeader 적용 매개변수                         | HTTP  요청 헤더와 매개변수를 매핑할 때(Ch04)       |
| @CookieValue 적용 매개변수                           | HTTP  쿠키와 매개변수를 매핑할 때(Ch04)            |
| @ModelAttribute,  @SessionAttribute, 커맨드  객체    | HTTP  요청 파라미터를 객체로 저장할 때(Ch03)       |
| Model,  @ModelAttribute                              | 뷰에 데이터를 전달할 때(Ch05)                      |
| Errors, BindingResult                                | 유효성 검사 실패를 저장할 때(Ch08)                 |



| 리턴 타입        | 설명                                                    |
| ---------------- | ------------------------------------------------------- |
| **ModelAndView** | 뷰 이름 및 모델 정보를 전달(Ch05)                       |
| String           | 뷰 이름을 전달(Ch05)                                    |
| void             | OutputStream, Writer를 이용해서 직접 응답을 생성할 경우 |



### modelandview 작성예시

```java
@GetMapping("/modelandview")
	public ModelAndView method5() {
		logger.info("ch02실행5");
		ModelAndView modeAndView = new ModelAndView();
		modeAndView.setViewName("ch02/modelandview");
		return modeAndView;
    }
```



모델객체를 선언하고 

String으로 리턴할 값을

```java
modeAndView.setViewName("ch02/modelandview");
```

이렇게하면 string 으로 표시한것과 같다.





위의 modelandview 방식은 아래의 코드와 같게 작동한다.

![image](https://user-images.githubusercontent.com/65274952/131061674-0f1b808e-7a03-40c4-b009-b8cddaaa8c3b.png)

모델엔뷰는 요즘은 잘 활용하지 않지만 사용하는 회사도 있다.









# JSP 작성법 <% %>, <% %>

<%@ 는 페이지 지시자를 지정하는것 

<% %>는 사이에 자바 코드를 작성하겠다는 의미





```jsp
<% for(int i=1; i<=10; i++){%>
<tr>
    <th scope="row"><%=i%></th>
    <td>제목<%=i %></td>
    <td>내용<%=i %></td>
    <td>홍길동</td>
</tr>	
<% }%>			
```

이런식으로 사용가능

![image](https://user-images.githubusercontent.com/65274952/131066283-5e1457eb-08dc-42cf-895d-325a421d8bfd.png)





```
<a class = "btn btn-info btn-sm" href="/ch02/boardwriteform">게시물 작성</a>
```

이걸 매핑시켜야한다.

ch02 를 가지고있는 

ch02 controller 접근

boardwriteform 매핑시키고

리턴값에해당하는 jsp 만들기



```
<form method="POST" action="ch02/boardwrite">
```

action 넣어주기



```
<button type="submit" class="btn btn-primary bnt-sm">저장</button>
```





# 경로

아래에서 href 뒤에 오는 내용은 절대 경로다.

/ 는 root 임

```html
<a class = "btn btn-info btn-sm" href="/ch02/boardlist">게시물 목록</a>
```



상대경로는 

상위경로기준으로 뒤의내용만 바꾸는 것임

상대경로로 표시할때는 / 치면 안된다.

```
http://localhost:8080/ch02/content
에서 맨뒤의 content 자리만 바꾸는 것임

```



예시

```html
<a class = "btn btn-info btn-sm" href="/ch02/boardlist">게시물 목록</a>
<a class = "btn btn-info btn-sm" href="/ch02/boardwriteform">게시물 작성</a>

<a class = "btn btn-info btn-sm" href="boardlist">게시물 목록</a>
<a class = "btn btn-info btn-sm" href="boardwriteform">게시물 작성</a>
```



![image](https://user-images.githubusercontent.com/65274952/131067857-e3a1d3fd-eaff-40e3-9bdd-49bd1b293de8.png)

만약 context root 를 변경한다면? 절대경로는 다 틀어진다

절대경로의 가장 앞은 context root 이기 때문에



그런데 context root 가 바뀔일이 은근히 있다.

-> 절대경로면 좀 곤란하겠지?



해결법은???





# 자투리

> 경로는 모두 소문자로 작성하는게 국룰이다.



explorer 보는 방식 변경

![image](https://user-images.githubusercontent.com/65274952/131052093-0bc67bb9-e101-46b1-97c3-750d59b1a471.png)



![image](https://user-images.githubusercontent.com/65274952/131052221-d7e03acf-2609-4f32-86b5-280fa0eb9e2d.png)

패키지 안에 서브 패키지를 만들어도 상관이없다.

루트가 되는 메인 패키지 안에만 있으면 된다.



> logger import할때는 sjf4logger 써야함

![image](https://user-images.githubusercontent.com/65274952/131052872-abb9f479-1c36-402a-8d4e-a0f8c6ace61c.png)

> 어노테이션도 클래스이기 때문에 import 과정이 필요하다.
>
> 



+TCP/IP Monitor

![image](https://user-images.githubusercontent.com/65274952/131060289-d117ec64-0db5-426c-b72c-93ecc5b03d76.png)

위에서 계속해서 새로운 탭이 나오는게 아니다

왜 get post 는 나오는데 DELETE PUT은 안나오나??? 했었는데

get post 처럼 탭을 갱신? 하지 않으면 

기존 내용의 아래에 추가적으로 붙는거였다.



jsp 주석은 이렇게 다는게 좋다

![image](https://user-images.githubusercontent.com/65274952/131063374-d1d3e3be-ee6d-4fe5-ab32-b3b04f3beb94.png)



html 주석으로 달면 응답에 포함되어서 주석이 사용자에게 전송된다.

![image](https://user-images.githubusercontent.com/65274952/131063545-7a8a4a0f-c828-4f7e-930d-411614bfebd8.png)

<%-- --%>



> jsp 는 자바로 변환해서 읽는다

그래서 자바코드 넣을 수 있음



> 링크로 요청왔음 -> get 방식만 가능
>
> form 은 get post 가능
