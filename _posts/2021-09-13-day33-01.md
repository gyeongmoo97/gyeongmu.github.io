

---
title: Day31
layout: single
author_profile: true
read_time: true
comments: true
share: true
related: true
categories:

- DB
description: .

meta_keywords: java,static,memory
last_modified_at: '2021-08-10 12:00:00 +0800'
toc: true
toc_sticky: false
toc_label: 목차
---

 {% raw %}

# 이전시간

다양한 DB (oracle mysql mssql)에 연결하기위한 표준 API로 JDBC를 상용한다. API는 인터페이스로 다른 DB를 사용하더라도 같게 기능하게 해준다.

각 DB가 제공해주는 dirver는 JDBC인터페이스를 구현하여 만들어 졌기 때문에 JDBC API 에 다른 DB의 Driver가 들어가도 JDBC의 기능은 같게 작동한다.



java.sql 이 JDBC 패키지다. 알아두는게 좋긴하다.



IP로 물리적인 서버의 위치를 찾고 포트를 통해 DB를 찾으면 ID PW를 입력하여 DB와 연결된다.



# DataSource

커넥션 풀을 위한 인터페이스





아래쪽 설정은 

![image](https://user-images.githubusercontent.com/65274952/133008322-c2797acd-dc8d-4c2c-b4b6-916b70dee499.png)

property로 setter DI 해준다 value 로 들어가는값이 set 된다.

url 은 tcp 방식으로 간다는 정보와 ip port id 가 적혀있다.



![image](https://user-images.githubusercontent.com/65274952/133008681-e63dd811-ebd2-4ecc-8c7e-31b9609e4d99.png)

개발할때는 max2 정도로 하면 된다.



maxIdel -> 사용자가 거의 없어져 connection을 close 할 때 남길 connection의 수 일반적으로 initalSize와 같은 값으로 둔다.



다른 DB를 연결해도 비슷한 결이지만 작성 방법이 조금씩 달라진다.

# DB 사용자 만들기

![image](https://user-images.githubusercontent.com/65274952/133008900-4c259f86-6124-426f-9411-9871ce997da7.png)
![image](https://user-images.githubusercontent.com/65274952/133008989-4c2e13de-defe-44d6-97e2-6465501e1298.png)

![image](https://user-images.githubusercontent.com/65274952/133009014-7df53416-e82b-46a2-9f1c-2c79a2018681.png)

설정 복사해서 만들 수 있음
![image](https://user-images.githubusercontent.com/65274952/133009141-e1183224-c27c-4a64-994a-ddeaf1eeac4c.png)

![image](https://user-images.githubusercontent.com/65274952/133009219-df602f55-3fcd-4cd5-b355-0e93da1556c2.png)
connect는 연결 db연결에 관한 권한이다.
![image](https://user-images.githubusercontent.com/65274952/133009240-414190c1-70a8-4898-a9c9-02aa044d15e6.png)
테이블 뷰 인덱스 시퀀스 같은 내용 모두가 resource다



![image](https://user-images.githubusercontent.com/65274952/133009321-78cf663a-59e3-4382-b16d-fca784455882.png)
테이블 공간이 허용하는 범위 내에서 제한없이 데이터를 저장할 수 있게 해주는 권한
![image](https://user-images.githubusercontent.com/65274952/133009419-86535c3f-4725-4edc-87b1-ffe437e0f2d5.png)
sql 문으로 생성된 유저 생성

oracle dev 에서 만든 문장은 모두 큰따옴표가 포함된다.
![image](https://user-images.githubusercontent.com/65274952/133009505-19f7953a-fb05-444f-abf3-6ea26486a065.png)

나중에 로그인 할 때 도 큰따옴표를 붙이여 하는 곤란함이 있을 것이기 때문에 큰따옴표 계정과 비밀번호에 붙은것 날려준다.





```xml
<bean id="dataSource" class="org.apache.commons.dbcp2.BasicDataSource" destroy-method="close">
 	
```

connection을 취소하는 메서드의 이름을 close로 둔다.







![image](https://user-images.githubusercontent.com/65274952/133011175-2220b7c3-9fbb-415f-a61e-f2269b048f89.png)

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
                           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd">

    <!-- Connection Pool -->
    <bean id="dataSource" class="org.apache.commons.dbcp2.BasicDataSource" destroy-method="close">
        <!-- 연결에 대한 정보 -->
        <property name="driverClassName" value="oracle.jdbc.OracleDriver"></property>
        <property name="url" value="jdbc:oracle:thin:@kosa1.iptime.org:50105:orcl"></property>
        <property name="username" value="spring"></property>
        <property name="password" value="oracle"></property>
        <!-- CP 에 대한 정보  -->
        <property name="initialSize" value="2"></property>
        <property name="maxTotal" value="3"></property>
        <property name="maxIdle" value="3"></property>
    </bean>



</beans>

```





![image](https://user-images.githubusercontent.com/65274952/133012128-91cb12ca-ee01-472f-abf3-132c9951746f.png)

해당빈은 DataSource 인터페이스를 구현한 클래스의 객체를 만든것이다. 



```java
//bean 에 있는 dataSource 를 Ch14cotroller 에 DI 
@Resource
private DataSource dataSource;
```



```java
@GetMapping("/testConnectToDB")
public String testConnectToDB() throws SQLException{

    Connection conn =  dataSource.getConnection();
    logger.info(" 연결 성공 ");

    //연결 객체 반납하기 close 는 닫는게 아닌 connection pool로 반납하여 가용한 상태로 남는것이다.
    conn.close();
    return "redirect:/ch14/content";
}
```



![image-20210913105333471](C:\Users\mwe22\AppData\Roaming\Typora\typora-user-images\image-20210913105333471.png)









# 자투리

![image](https://user-images.githubusercontent.com/65274952/133014889-ff8ef392-35b8-46cc-9e16-d6a001c8dd7b.png)
![image](https://user-images.githubusercontent.com/65274952/133014897-62720285-2647-4e8d-ae62-5036af6fd1a5.png)
![image](https://user-images.githubusercontent.com/65274952/133014901-9c8c986b-d1ed-4e5f-b1a6-883ecdd196f4.png)
![image](https://user-images.githubusercontent.com/65274952/133014909-c0b9463c-464f-4cbc-afd5-40f6a1612b81.png)



나중에 DB 쓸 일 있으면 딴건 필요없고 아래 두개 정도는 사용할때 켜면 된다.
![image](https://user-images.githubusercontent.com/65274952/133014929-f208343e-af00-48ab-8692-003dcab93e38.png)
![image](https://user-images.githubusercontent.com/65274952/133014941-2a9468b4-f560-41f9-bea3-d563dac97d73.png)



 {% endraw %}